input {
  http_poller {
    urls => {
        #"localhost" => "http://elastic:ChangemE456@localhost:9200/data/_search?pretty"
        "localhost" => "https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=50&order=date&relevanceLanguage=en&fields=items(id,snippet(title,description,channelId,channelTitle,publishedAt,liveBroadcastContent))&topicId=%2Fm%2F07c1v&type=video&key=AIzaSyDRU6vwN5ZhZWaZAVFRBO9JzWSc2C83UyU"
   }
  type => "tech"
    request_timeout => 60
    interval => 600
}}
 filter { 
  if [type] == "tech" { 
  split {
     field => "items"
    }
        mutate {
         add_field => { "split" => " "}
         #add_field => { "raw_data" => " "}
        }

#ruby {
    #code => "
     #e = event.get('items').to_s
     #e.gsub!(/[^0-9A-Za-z]/, ' ')
     #term = e.is_a? String
     #event.set('raw_data', e)
     #spl = e.split('/[\s,]+/')
     
     #term = spl.is_a? Array
     #event.set('split', spl)
     #event.set('term', term)

#"
#}
 uuid {
       target => "@uuid"
       overwrite => true
    }
   fingerprint {
      source => ["items"]
      target => "fingerprint"
      key => "78787878"
      method => "SHA1"
      concatenate_sources => true
   }
  }
}
 output {
  if [type] == "tech" {
  elasticsearch {
        hosts => [ "localhost:9200" ]
        user => "elastic"
        password => "ChangemE456"
	document_id => "%{fingerprint}"
	index => "tech-%{+YYYY.MM.dd}"
  }
 }
 }
